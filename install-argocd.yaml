repositories:
  - name: argo
    url: https://argoproj.github.io/argo-helm

releases:
  - name: argocd
    namespace: argocd
    labels:
      app: argocd
    chart: argo/argo-cd
    version: ~5.52.2
    values:
      - configs:
          params:
            server.insecure: "true"
      - server:
          ingress:
            annotations:
              kubernetes.io/tls-acme: "true"
              cert-manager.io/cluster-issuer: letsencrypt-prod
            enabled: true
            hosts:
               - argo.vojk.au
            tls:
              - secretName: argocd-tls
                hosts:
                  - argo.vojk.au
      - global:
          tolerations:
            - key: tempnode
              operator: Equal
              value: "true"
              effect: NoExecute
      - repoServer:
          extraContainers:
            - name: plugin
              image: lucj/argocd-plugin-helmfile:v0.0.11
              command: ["/var/run/argocd/argocd-cmp-server"]
              securityContext:
                runAsNonRoot: true
                runAsUser: 999
              volumeMounts:
                - mountPath: /var/run/argocd
                  name: var-files
                - mountPath: /home/argocd/cmp-server/plugins
                  name: plugins
